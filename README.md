# dify-telegram_bot
让你的telegram bot接入dify

项目名称：Dify Telegram Bot

项目简介：

本项目是一个基于 Telegram Bot API 和 Dify API 的智能聊天机器人。它能够将 Telegram 用户发送的消息（包括文本、图片、语音、文档）转发给 Dify，并处理 Dify 返回的流式响应（包括文本、图片、语音）。该机器人支持多用户、多会话，并具有以下特点：

    流式响应处理： 能够处理 Dify 的流式响应，实时将文本、图片和语音消息发送给用户。

    多媒体消息支持： 支持文本、图片、语音和文档等多种消息类型。

    会话管理： 能够为每个用户维护独立的会话，实现上下文连贯的对话。

    API 密钥管理： 支持为不同用户设置不同的 Dify API 密钥，方便管理和切换。

    速率限制： 防止用户滥用，对每个用户的请求频率进行限制。

    断线重连： 自动检测 Telegram 连接状态，并在断开后尝试重新连接。

    文件上传： 支持将用户发送的文件上传到 Dify。

    可持久化： 支持对话数据持久化存储, 避免bot重启后信息丢失。

使用说明：

    准备工作：

        拥有一个 Telegram 账号和一个 Telegram Bot Token。

        拥有一个 Dify 账户，并创建一个 Dify 应用以获取 API 密钥。

    部署：

        将代码部署到服务器或本地计算机。

        修改 DATA_FILE 变量, 确认程序有对应目录的读写权限。

        运行代码。

    Telegram Bot 命令：

        /start: 启动机器人，并显示欢迎消息。

        /set <api_key_alias>: 设置当前用户使用的 Dify API 密钥别名。

        /check_queue: 检查消息队列大小（用于调试）。

    与机器人交互：

        直接向机器人发送文本消息、图片、语音或文档。

        机器人会将消息转发给 Dify，并返回 Dify 的响应。

        图片和语音消息会以 Telegram 原生格式发送。
